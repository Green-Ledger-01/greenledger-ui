#!/bin/sh
# Pre-push hook for GreenLedger UI
# Runs tests and build checks before pushing

echo "ğŸš€ Running pre-push checks..."

# Check if we're pushing to main/master
protected_branch='main'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

if [ "$current_branch" = "$protected_branch" ]; then
    echo "ğŸ”’ Pushing to protected branch: $protected_branch"
    echo "ğŸ§ª Running comprehensive checks..."
    
    # Run tests if available
    if npm run test 2>/dev/null; then
        echo "âœ… Tests passed!"
    else
        echo "âš ï¸  Tests not configured or failed"
    fi
    
    # Run build check
    echo "ğŸ—ï¸  Checking build..."
    if npm run build 2>/dev/null; then
        echo "âœ… Build successful!"
    else
        echo "âŒ Build failed!"
        exit 1
    fi
else
    echo "ğŸ“ Pushing to feature branch: $current_branch"
    echo "ğŸ” Running basic checks..."
fi

# Check for merge conflicts
if git diff --check; then
    echo "âœ… No merge conflict markers found"
else
    echo "âŒ Merge conflict markers detected!"
    exit 1
fi

echo "âœ… Pre-push checks completed!"
exit 0