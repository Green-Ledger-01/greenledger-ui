#!/bin/sh
# Pre-commit hook for GreenLedger UI
# Runs linting, formatting, and basic checks before commit

echo "üîç Running pre-commit checks..."

# Check if npm is available
if ! command -v npm &> /dev/null; then
    echo "‚ùå npm not found. Please install Node.js and npm."
    exit 1
fi

# Run TypeScript type checking
echo "üìù Checking TypeScript types..."
if ! npm run type-check 2>/dev/null; then
    echo "‚ö†Ô∏è  TypeScript check not available, skipping..."
fi

# Run linting
echo "üßπ Running ESLint..."
if ! npm run lint 2>/dev/null; then
    echo "‚ö†Ô∏è  ESLint not configured, skipping..."
fi

# Check for common issues
echo "üîç Checking for common issues..."

# Check for console.log statements (excluding development files)
if git diff --cached --name-only | grep -E '\.(ts|tsx|js|jsx)$' | xargs grep -l 'console\.log' 2>/dev/null; then
    echo "‚ö†Ô∏è  Warning: console.log statements found in staged files"
    echo "   Consider removing them before committing to production"
fi

# Check for TODO/FIXME comments in staged files
if git diff --cached --name-only | xargs grep -l 'TODO\|FIXME' 2>/dev/null; then
    echo "‚ÑπÔ∏è  Info: TODO/FIXME comments found in staged files"
fi

# Check for large files (>1MB)
large_files=$(git diff --cached --name-only | xargs ls -la 2>/dev/null | awk '$5 > 1048576 {print $9 " (" $5 " bytes)"}')
if [ -n "$large_files" ]; then
    echo "‚ö†Ô∏è  Warning: Large files detected:"
    echo "$large_files"
fi

echo "‚úÖ Pre-commit checks completed!"
exit 0